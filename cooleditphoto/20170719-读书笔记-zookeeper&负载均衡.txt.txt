大型分布式网站架构设计与实践第一章 读书笔记
1.RPC主要包括服务提供方和服务调用方，在集群中还需要路由和负载均衡
2.rpc协议有基于HTTP的和TCP的
3.HTTP协议的rpc的请求包括编码、命令和命令长度三个字段，响应包括编码、响应内容、响应内容长度三个字段
4.SOA架构中，服务消费者通过服务名称，在众多服务中找到要调用的服务的地址列表，称为服务的路由。
5.负载均衡与ZOOKEEPER
  5.1 服务配置中心负责服务的动态注册以及获取服务信息
  5.2 服务消费者只有在第一次调用时访问配置中心，之后会使用本地缓存的服务地址列表，除非服务信息有变化
  5.3 负载均衡算法主要包括轮询法、随机法、最小连接数法等。
      有一个serverweightmap的Map变量来表示服务器地址和权重的映射，在实现负载均衡算法时，需要先新建局部变量serverMap，将域变量serverweightmap复制到线程本地，以避免并发问题
  5.4 轮询法：需要用到synchronized关键字，以防止不同线程修改位置变量pos值，因此性能不好
  5.5 随机法：分配到某一个地址的比例的效果会趋近于轮询法，性能优于轮询法
  5.6 源地址哈希法：同一IP地址的客户端，当后端服务器列表不变时，会被映射到同一后端服务器。
  5.7 加权轮询法：考虑服务器的配置和负载，加入权重，其他类似轮询
  5.8 加权随机法：考虑服务器的配置和负载，加入权重，其他类似随机法
  5.9 最小连接数法：动态地选择当前积压连接数最小的一台服务器
6.zookeeper通过zab协议保持数据一致性
7.zookeeper的节点叫做znode，znode除了包含数据外，还可能有子节点，当节点上的数据和子节点发生变化时，基于watcher机制，会发出相应的通知。
8.为了监控服务提供者和服务消费者，每个服务包含consumer和provider两种节点类型
